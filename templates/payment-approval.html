{% extends "layout-main.html" %}
{% block head %}
    {{ super() }}
    {% block scripts %}
    <script src="static/script/numberWithSpaces.js"></script>
<!--    <script src="static/script/paymentApprovalSort.js"></script>-->
    <script src="static/script/paymentApprovalSaveChanges.js"></script>
    <script src="static/script/paymentApprovalRecalcCards.js"></script>
    <script src="static/script/paymentApprovalColorize.js"></script>


<!--<script>-->

<!--console.log('&#45;&#45;&#45;&#45;', new Date())-->
<!--var getCellValue = (tr, idx) => tr.children[idx].dataset['sort'];-->
<!--console.log(0)-->
<!--var comparer = (idx, asc) => (a, b) =>-->
<!--((v1, v2) => v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : (console.log('   -   v1', v1), console.log('   -   v2', v2), v1.toString().localeCompare(v2)))-->
<!--    (getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));-->

<!--console.log(1)-->

<!--document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {-->
<!--  console.log(2)-->
<!--  var table = th.closest('table');-->
<!--  console.log(3)-->
<!--  var tbody = table.querySelector('tbody');-->
<!--  console.log(4)-->
<!--  Array.from(tbody.querySelectorAll('tr'))-->
<!--    .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))-->
<!--    .forEach(tr => tbody.appendChild(tr) );-->
<!--})));-->



<!--</script>-->


    <style>
        .cards-container {
            display: flex;
            flex-wrap: wrap;
        }
        .card {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin: 10px;
            width: 300px;
        }
        .card-title {
            color: black;
            font-weight: bold;
            font-size: 250%;
        }
        .card-cost {
            color: grey;
            font-size: 60%;
        }
    </style>
    {% endblock %}
{% endblock %}
{% block content %}

<div class="cards-container">
    <div class="card" id="card_selected_for_approval">
        <h2 class="card-title" id="card_selected_for_approval_value">&nbsp;</h2>
        <p class="card-cost">Выбрано для одобрения</p>
    </div>
    <div class="card" id="card_available_money">
        <h2 class="card-title" id="card_available_money_value" data-value="{{ available_money }}">{{ available_money }} ₽</h2>
        <p class="card-cost">ДС доступные к распределению</p>
    </div>
    <div class="card" id="card_account_money">
        <h2 class="card-title" id="card_account_money_value" data-value="{{ account_money }}">{{ account_money }} ₽</h2>
        <p class="card-cost">ДС на счету</p>
    </div>

</div>
<div class="cards-container">
    <form action="payment-approval" target="_blank">
       <button style="background-color:#4285f4;">Согласование</button>
    </form>
    <form action="payment-approval-list" target="_blank">
       <button>Согласованные платежи</button>
    </form>
    <form action="payment-paid-list" target="_blank">
       <button>Оплаченные платежи</button>
    </form>
</div>


<h1>{{title}}</h1>


<form id="paymentForm3" action="/payment-approval" method="POST" style="align-self: flex-start">
    <button type="submit">Submit</button>
    <table id="payment-table" name="payment_table" class="display">
        <thead>
            <tr>
                <th>№</th>
                <th>ВЫБОР</th>
                <th>СИП/КПЛН</th>
                <th>СТАТЬЯ ЗАТРАТ</th>
                <th>№ ПЛАТЕЖА</th>
                <th>НАИМЕНОВАНИЕ ПЛАТЕЖА</th>
                <th>ОПИСАНИЕ</th>
                <th>ОБЪЕКТ</th>
                <th>ОТВЕТСТВЕННЫЙ</th>
                <th>КОНТРАГЕНТ</th>
                <th>ОБЩАЯ СУММА</th>
                <th>ОСТАТОК К ОПЛАТЕ</th>
                <th>СОГЛАСОВАННАЯ СУММА</th>
                <th>СРОК ОПЛАТЫ</th>
                <th>СТАТУС</th>
                <th>ДАТА СОЗДАНИЯ</th>
                <th>СОХРАНИТЬ ДО ПОЛНОЙ ОПЛАТЫ</th>
<!--                <th onclick="sortTable2()">№</th>-->
<!--                <th onclick="sortTable2()">ВЫБОР</th>-->
<!--                <th onclick="sortTable2()">СИП/КПЛН</th>-->
<!--                <th onclick="sortTable2()">СТАТЬЯ ЗАТРАТ</th>-->
<!--                <th onclick="sortTable2()">№ ПЛАТЕЖА</th>-->
<!--                <th onclick="sortTable2()">НАИМЕНОВАНИЕ ПЛАТЕЖА</th>-->
<!--                <th onclick="sortTable2()">ОПИСАНИЕ</th>-->
<!--                <th onclick="sortTable2()">ОБЪЕКТ</th>-->
<!--                <th onclick="sortTable2()">ОТВЕТСТВЕННЫЙ</th>-->
<!--                <th onclick="sortTable2()">КОНТРАГЕНТ</th>-->
<!--                <th onclick="sortTable2()">ОБЩАЯ СУММА</th>-->
<!--                <th onclick="sortTable2()">ОСТАТОК К ОПЛАТЕ</th>-->
<!--                <th onclick="sortTable2()">СОГЛАСОВАННАЯ СУММА</th>-->
<!--                <th onclick="sortTable2()">СРОК ОПЛАТЫ</th>-->
<!--                <th onclick="sortTable2()">СТАТУС</th>-->
<!--                <th onclick="sortTable2()">ДАТА СОЗДАНИЯ</th>-->
<!--                <th onclick="sortTable2()">СОХРАНИТЬ ДО ПОЛНОЙ ОПЛАТЫ</th>-->
            </tr>
        </thead>
        <tbody>
            {% for application in applications %}
            <tr id="row-{{ loop.index }}">
                <td data-sort="{{ loop.index }}">{{loop.index}}</td>
                <td data-sort={{ loop.index }}>
                    <input
                        type="checkbox"
                        id="selectedRows-{{ loop.index }}"
                        name="selectedRows"
                        value="{{loop.index}}"
                        onchange="paymentApprovalRecalcCards()">
                </td>
                <td data-sort="{{application.contractor_id}}">{{ application.contractor_name }}</td>
                <td data-sort="{{application.cost_item_name}}">{{ application.cost_item_name }}</td>
                <td data-sort="{application.payment_id}}">
                    <input
                        id="paymentNumber-{{ loop.index }}"
                        name="payment_number"
                        value="{{application.payment_id}}"
                        hidden
                        readonly>
                    {{application.payment_number}}
                </td>
                <td data-sort="{{application.basis_of_payment}}" title="{{ application.basis_of_payment }}">{{ application.basis_of_payment_short }}</td>
                <td data-sort="{{application.basis_of_payment}}" title="{{ application.payment_description }}">{{ application.payment_description_short }}</td>
                <td data-sort="{{application.object_name}}">{{ application.object_name }}</td>
                <td>{{ application.last_name }} {{ application.first_name[0] }}.</td>
                <td>{{ application.partner }}</td>
                <td>{{ application.payment_sum_rub }}</td>
                <td>
                    <input
                        id="approvalSum-{{ loop.index }}"
                        name="approval_sum"
                        value="{{application.approval_sum}}"
                        hidden
                        readonly>
                    {{ application.approval_sum_rub}}
                </td>
                <td>
                    <input
                        id="amount-{{ loop.index }}"
                        name="amount"
                        value="{{ application.amount_rub }}"
                        onchange="saveData({{ loop.index }}, '{{ page }}')"
                        oninput="paymentApprovalRecalcCards()">
                </td>
                <td>{{ application.payment_due_date }}</td>
                <td id="status-{{ loop.index }}">
                    <select
                        id="status_id-{{ loop.index }}"
                        name="status_id"
                        data-amount="{{ 444 if application.status_id==4 else 33333}}"
                        onchange="paymentApprovalRecalcCards(), saveData({{ loop.index }}, '{{ page }}')">
                        {% for s in approval_statuses %}
                        <option
                            {% if application.status_id==s.payment_agreed_status_id %} selected {% endif %}>
                            {{ s.payment_agreed_status_name }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
                <td>{{ application.payment_at }}</td>
                <td>
                    <input
                        type="checkbox"
                        id="paymentFullStatus-{{ loop.index }}"
                        name="payment_full_agreed_status"
                        value="{{loop.index}}"
                        {% if application.payment_full_agreed_status %}checked{% endif %}
                        onchange="saveData({{ loop.index }}, '{{ page }}'), tabColorize({{ loop.index }})">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</form>

{% endblock %}